$(document).on("click","#viewRentButton",function(){const e=$(this).data("rent-id");i(e)});$(document).on("click","#approveButton",function(){const e=$(this).data("rent-id");c(e)});$(document).on("click","#declineButton",function(){const e=$(this).data("rent-id");l(e)});$(document).on("click","#returnCarButton",function(){const e=$(this).data("rent-id");s(e)});function i(e){$.get(`/rent-request/${e}`).done(function(n){const t=n.data;$("#carName").text(`${t.model} (${t.tahun})`),$("#carType").text(`${t.transmission} - ${t.bahan_bakar}`),$("#carNumber").text(t.plat_nomor),$("#customerName").text(t.user_name),$("#customerEmail").text(t.user_email),$("#customerPhone").text(t.user_phone),$("#rentStartDate").text(t.rent_start),$("#rentEndDate").text(t.rent_end),$("#rentStatus").text(t.rent_status),$("#rentTotalPrice").text(`Rp. ${parseFloat(t.total_price).toLocaleString("id-ID")}`),$("#pricePerDay").text(`Rp. ${parseFloat(t.price_per_day).toLocaleString("id-ID")}`),$("#declineButton").data("rent-id",e),$("#approveButton").data("rent-id",e),t.rent_status.toLowerCase()==="pending"?$(".modal-footer .btn-approve, .modal-footer .btn-decline").show():$(".modal-footer .btn-approve, .modal-footer .btn-decline").hide(),$("#rentRequestModal").modal("show")}).fail(function(){Swal.fire({icon:"error",title:"Error",text:"Unable to fetch rent details"})})}function c(e){Swal.fire({title:"Approve Rent",text:"Are you sure you want to approve this rent?",icon:"question",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, approve it!"}).then(n=>{n.isConfirmed&&$.ajax({url:`/rents/${e}/approve`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){Swal.fire({icon:"success",title:"Approved!",text:"Rent has been approved successfully."}).then(()=>{location.reload()})},error:function(){Swal.fire({icon:"error",title:"Error",text:"Unable to approve rent"})}})})}function l(e){const n=bootstrap.Modal.getInstance(document.querySelector(".modal"));n.hide(),setTimeout(()=>{Swal.fire({title:"Decline Rent",text:"Are you sure you want to decline?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, decline it!",input:"textarea",inputPlaceholder:"Enter decline message",backdrop:!0,showLoaderOnConfirm:!0,preConfirm:t=>t?$.ajax({url:`/rents/${e}/decline`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),decline_message:t}}).catch(r=>{var o;Swal.showValidationMessage("Request failed: "+(((o=r.responseJSON)==null?void 0:o.message)||"Unable to decline rent request"))}):(Swal.showValidationMessage("Please provide a reason for declining"),!1)}).then(t=>{t.isConfirmed?Swal.fire({icon:"success",title:"Declined!",text:"Rent request has been declined successfully."}).then(()=>{location.reload()}):n.show()})},150)}function s(e){$.ajax({url:`/rent-requests/${e}/check-penalty`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(n){let t="Are you sure you want to return this car?",r="";n.is_late&&(r=`
                    <div class="text-start mb-3">
                        <table class="table table-sm">
                            <tr>
                                <td>Return Deadline</td>
                                <td>: ${n.return_deadline}</td>
                            </tr>
                            <tr>
                                <td>Days Late</td>
                                <td>: ${n.days_late} days</td>
                            </tr>
                            <tr>
                                <td>Penalty per Day</td>
                                <td>: Rp ${n.price_per_day_formatted}</td>
                            </tr>
                            <tr class="table-warning">
                                <td class="fw-bold">Total Penalty</td>
                                <td class="fw-bold">: Rp ${n.penalty_amount_formatted}</td>
                            </tr>
                        </table>
                    </div>`),Swal.fire({title:"Return car?",html:r,text:n.is_late?"":t,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, return it!"}).then(o=>{o.isConfirmed&&$.ajax({url:`/rent-requests/${e}/return`,type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(a){Swal.fire({icon:a.status,title:"Success",text:"Car has been returned successfully."}).then(()=>location.reload())},error:function(){Swal.fire({icon:"error",title:"Error",text:"Unable to process car return"})}})})},error:function(){Swal.fire({icon:"error",title:"Error",text:"Unable to check penalty information"})}})}
