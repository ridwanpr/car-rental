$(document).ready(function(){function i(t,a){const n=new Date(t),e=new Date(a),r=Math.abs(e-n);return Math.ceil(r/(1e3*60*60*24))}function l(t){const a=t.find(".rent-start").val(),n=t.find(".rent-end").val();if(a&&n){const e=i(a,n),r=parseFloat(t.find(".price-per-day").text().replace("Rp.","").replace(/,/g,"")),o=e*r;t.find(".total-price").text("Rp."+o.toFixed(0).replace(/\d(?=(\d{3})+$)/g,"$&,"))}}function s(){let t=0;$(".total-price").each(function(){const a=$(this).text().replace("Rp.","").replace(/,/g,"");isNaN(a)||(t+=parseFloat(a))}),$("#total-price").text("Rp."+t.toFixed(0).replace(/\d(?=(\d{3})+$)/g,"$&,"))}$(document).on("change",".rent-start, .rent-end",function(){const t=$(this).closest("tr"),a=t.find(".rent-start").val(),n=t.find(".rent-end").val();if(a&&n){if(new Date(n)<=new Date(a)){Swal.fire({icon:"warning",title:"Attention",text:"End date must be after start date"}),$(this).val("");return}l(t),s()}}),$("#payment_method").on("change",function(){const t=$(this).val();console.log(t==="auto"?"auto":"manual")}),$("#checkout").on("click",function(){let t=!0,a=[];if($("table tbody tr").each(function(){const e=$(this),r=e.find(".rent-start").val(),o=e.find(".rent-end").val();if(!r||!o)return t=!1,Swal.fire({icon:"warning",title:"Attention",text:"Please fill in all rental dates"}),!1;const c=parseFloat(e.find(".total-price").text().replace("Rp.","").replace(/,/g,"")),d=parseFloat(e.find(".price-per-day").text().replace("Rp.","").replace(/,/g,""));a.push({car_id:e.data("car-id"),rent_start:r,rent_end:o,price_per_day:d,total_price:c})}),!t)return;const n=$("#payment_method").find(":selected").val();$.ajax({url:"/checkout",method:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{rentals:a,total_amount:parseFloat($("#total-price").text().replace("Rp.","").replace(/,/g,"")),payment_method:n},success:function(e){e.redirect&&(window.location.href=e.redirect)},error:function(e,r,o){console.error("Checkout error:",o);const c=e.responseJSON.message||"An error occurred during checkout. Please try again.";Swal.fire({icon:"error",title:"Attention",text:c})}})})});
